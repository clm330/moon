<!DOCTYPE html>
<style>
.node {
	stroke: #fff;
    stroke-width: 5px;
}

.node .selected {
  stroke: black;
}

.mouseover{
	stroke: #999;
}

.comment{
	width: 50px;
}

</style>
<svg width="960" height="500"></svg>
<div>
	<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" style="width:0;height:0;position:absolute;overflow:hidden;">
	  <defs>
	<symbol viewBox="0 0 34 32" aria-labelledby="assi-evil-comment-title" id="si-evil-comment"><title id="assi-evil-comment-title">icon comment</title>
	<path d="M7 32H5l1.2-1.6c.8-1.1 1.3-2.5 1.6-4.2C2.8 23.9 0 19.6 0 14 0 5.4 6.5 0 17 0s17 5.4 17 14c0 8.8-6.4 14-17 14h-.7c-1.6 1.9-4.4 4-9.3 4zM17 2C7.6 2 2 6.5 2 14c0 6.4 3.9 9.4 7.2 10.7l.7.3-.1.8c-.2 1.6-.5 3-1.1 4.2 3.3-.4 5.2-2.1 6.3-3.5l.3-.4H17c13.5 0 15-8.4 15-12C32 6.5 26.4 2 17 2z" style ="stroke: #000066;"/>
	</symbol>
	  </defs>
	</svg>
</div>


<!--   <svg class = "comment">
   <use xlink:href="#si-evil-comment"></use>
  </svg> -->


<script src="https://d3js.org/d3.v4.min.js"></script>
<script>
window.onload = function() {
	const gold = 1.618;
	const node_radius = 20;
	var comment = 0;

var margin = parseInt(d3.select("body").style("margin"));

	var svg = d3.select("svg"),
	    width = +svg.attr("width"),
	    height = +svg.attr("height"),
	    color = d3.scaleOrdinal(d3.schemeCategory10);

	var cyaninte_node = {
		nodes:[
			{name:'about us' },
			{name:"cyaninte"},
			{name:"future"}
		],
		links:[
			{ source : this.index  , target: 1 } ,
			{ source : this.index  , target: 2 } ,
			{ source : this.index  , target: 3 } ,
		]
	};

    var cyaninte_nodes = [],
    	cyaninte_name = {name:'cyaninte',parent:"cyaninte"},
    	cyaninte_about_us = {name:'about us',parent:"cyaninte"},
    	cyaninte_futrue = {name:'future',parent:"cyaninte"},
    	cyaninte_nodes =[cyaninte_name,cyaninte_about_us,cyaninte_futrue];

    var start = {name:"start"},
    	cyaninte = {name :"cyaninte",sub_nodes:cyaninte_nodes, spread :0},
        pepsi = {name :"pepsi"},
        mcdonalds ={name :"mcdonalds"},
        wangyu = {name:"wangyu"},
        ikea = {name:"ikea"},
        nodes =[start,cyaninte,pepsi,mcdonalds,wangyu,ikea],
        links = [];

    links.push({source: start, target: cyaninte}); // Add a-b.
    links.push({source: start, target: pepsi}); // Add a-b.
    links.push({source: start, target: mcdonalds}); // Add b-c.
    links.push({source: start, target: ikea}); // Add a-b.
    links.push({source: start, target: wangyu}); // Add a-b.

	var simulation = d3.forceSimulation(nodes)
	    .force("charge", d3.forceManyBody().strength(-1000))
	    .force("link", d3.forceLink(links).distance(123))
	    .force("x", d3.forceX())
	    .force("y", d3.forceY())
	    .alphaTarget(1)
	    .on("tick", ticked);

	var g = svg.append("g").attr("transform", "translate(" + width / 2 + "," + height / 2 + ")"),
	    link = g.append("g").attr("stroke", "#000").attr("stroke-width", 1.5).selectAll(".link"),
	    node = g.append("g").attr("stroke", "#fff").attr("stroke-width", node_radius/gold).selectAll(".node");

	restart();

	function restart() {
	  // Apply the general update pattern to the nodes.
	  node = node.data(nodes, function(d){
	                    return d.name;
	                   });
	  node.exit().remove();
	  node = node.enter().append("circle")
	  			 //.call(d3.drag())
	             .attr("fill", function(d) {
	             if(d.parent !==undefined)
	             	return color(d.parent);
	             else
	                return color(d.name);})
	             .attr("r", node_radius)
				 .call(d3.drag()
	             .on("start", dragstarted)
	             .on("drag", dragged)
	             .on("end", dragended))
				 .on('mouseout',function(d){
					d3.select(this)
					.transition()
					.duration(500)
					.attr("stroke",'white');

					if(comment === 1){
						d3.select(".comment").remove();
						comment = 0;
					}

				})
				.on('mouseover',function(d){
					d3.select(this)
					.transition()
					.duration(500)
					.attr("stroke","#999");
  // <svg class = "comment">
  //  <use xlink:href="#si-evil-comment"></use>
  // </svg>
 					if(comment === 0){
						var img = d3.select("svg").append("svg")
						            .attr("class","comment")
						            .attr("width","50px")
						            .attr("x",d3.event.clientX-25+6)
						            .attr("y",d3.event.clientY-height/2-25-margin)
						            .append("use")
						            .attr("xlink:href","#si-evil-comment")
						            .append("text")
						            .text("hello");
						comment = 1;
					}

				})
				.on('click',function(d){
					if(d.sub_nodes !== undefined && d.spread === 0){
						for(var tmp in d.sub_nodes){
							nodes.push(d.sub_nodes[tmp]);
							links.push({source:d,target:d.sub_nodes[tmp]});
						}
						restart();
						d.spread = 1;
					}
					else if(d.sub_nodes !== undefined && d.spread === 1){
						for(var tmp in d.sub_nodes){
							nodes.pop(d.sub_nodes[tmp]);
							links.pop({source:d,target:d.sub_nodes[tmp]});
						}
						restart();
						d.spread = 0;
					}
				})
				.merge(node);

			  // Apply the general update pattern to the links.
			  link = link.data(links, function(d) {
			   return d.source.id + "-" + d.target.id; 
			});
			  link.exit().remove();
			  link = link.enter().append("line").merge(link);

			  // Update and restart the simulation.
			  simulation.nodes(nodes);
			  simulation.force("link").links(links);
			  simulation.alpha(1).restart();
		}

	function ticked() {
	  node.attr("cx", function(d) { return d.x; })
	      .attr("cy", function(d) { return d.y; })

	  link.attr("x1", function(d) { return d.source.x; })
	      .attr("y1", function(d) { return d.source.y; })
	      .attr("x2", function(d) { return d.target.x; })
	      .attr("y2", function(d) { return d.target.y; });
	}


    function dragstarted(d) {
        if (!d3.event.active) simulation.alphaTarget(0.3).restart();
        d.fx = d.x;
        d.fy = d.y;
    }
    
    function dragged(d) {
        d.fx = d3.event.x;
        d.fy = d3.event.y;
    }
    
    function dragended(d) {
        if (!d3.event.active) simulation.alphaTarget(0);
        d.fx = null;
        d.fy = null;
    } 
}

</script>